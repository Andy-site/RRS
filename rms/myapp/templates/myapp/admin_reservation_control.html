{% extends 'myapp/admin_page.html' %}
{% block welcome %}{% endblock %}
{% block title %}Order Details{% endblock %}

{% block css %}
    /* CSS styles for table */
    table {
        width: 80%;
        border-collapse: collapse;
        margin-left: 280px;
        margin-top: 200px;
    }
    th, td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }
    th {
        background-color: #f2f2f2;
    }

    .pp{
    position: absolute;
    font-size: 30px;
    left: 650px;
    top: 76px;
    }

    /* Style for the checkbox */
    .confirmation-checkbox {
        transform: scale(1.5); /* Adjust size as needed */
    }

    /* Style for the checked checkbox */
    .confirmation-checkbox:checked + label::after {
        content: '\2714'; /* Unicode character for checkmark */
        color: green;
    }

    /* Style for the unchecked checkbox */
    .confirmation-checkbox + label::after {
        content: '\2718'; /* Unicode character for cross mark */
        color: red;
    }
    /* CSS for green row */
.green-row {
    background-color: green;
}

/* CSS for red row */
.red-row {
    background-color: red;
}

/* CSS for completed row */
.completed-row {
    background-color: #f2f2f2; /* Light grey background */
    text-decoration: line-through; /* Line through the text */
}




{% endblock %}

{% block content %}
<div class="pp">Order Details</div>
    <table>
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Username</th>
                <th>Date</th>
                <th>Time</th>
                <th>Number of People</th>
                <th>Message</th>
                <th>Confirm</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
                <tr {% if order.completed %}class="completed-row"{% endif %} >
<!--                    order_id = {{ order.id }}-->
                    <td>{{ order.id }}</td>
                    <td>{{ order.username }}</td>
                    <td>{{ order.date }}</td>
                    <td>{{ order.time }}</td>
                    <td>{{ order.number_of_people }}</td>
                    <td>{{ order.message }}</td>
                    <td>
                        <!-- Single checkbox with label -->

                         <input type="checkbox" id="confirm_checkbox_{{ order.id }}" class="confirmation-checkbox" name="confirm_checkbox" value="{{ order.id }}" {% if order.confirmed %}checked{% endif %}>
                            <label for="confirm_checkbox_{{ order.id }}"></label>
                    </td>
                    <td>
                        <!-- Update the onclick events to pass order.id -->
                        <button onclick="saveOrder({{ order.id }})">Confirm</button>
                        <button id="complete_order_button_{{ order.id }}" onclick="completeOrder({{ order.id }})">Completed</button>


                    </td>
                </tr>
            {% endfor %}
        </tbody>  03
    </table>



<!-- Add this script in your template -->
<script>
function saveOrder(orderId) {
    // Check if the checkbox is checked (green tick)
    var isChecked = $('#confirm_checkbox_' + orderId).is(':checked');

    // Make AJAX request to save_order view
    $.ajax({
        type: 'POST',
        url: '{% url "save_order" %}',
        data: {
            'order_id': orderId,
            'is_checked': isChecked,  // Send whether the checkbox is checked
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(data) {
            // Update the checkbox state based on the confirmed status returned from the server
            var confirmed = data.confirmed;
            $('#confirm_checkbox_' + orderId).prop('checked', confirmed);

            // Reload the page to reflect changes (optional)
            // location.reload();
        }
    });
}





    function completeOrder(orderId) {
    // Make AJAX request to complete_order view
    $.ajax({
        type: 'POST',
        url: '{% url "complete_order" %}',
        data: {'order_id': orderId, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        success: function(data) {
            // Find the row that contains the button and add the 'completed-row' class
            $('#complete_order_button_' + orderId).closest('tr').addClass('completed-row');
        }
    });
}








</script>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


{% endblock %}



